<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Check Booking Status - Copperway Car Wash</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
.btn-primary { background-color: #005DA8; color: white; }
.btn-secondary { border-color: #005DA8; color: #005DA8; }
.status-badge { padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; }
.status-pending { background-color: #FEF3C7; color: #92400E; }
.status-confirmed { background-color: #D1FAE5; color: #065F46; }
.status-progress { background-color: #DBEAFE; color: #1E40AF; }
.status-completed { background-color: #D1FAE5; color: #065F46; }
</style>
</head>
<body class="font-sans bg-gray-50">
<!-- Header -->
<header class="sticky top-0 bg-white shadow-md z-50">
<div class="container mx-auto flex justify-between items-center p-4">
<div class="text-2xl font-bold text-[#005DA8]">Copperway Car Wash</div>
<nav>
<ul class="flex space-x-6">
<li><a href="index.html" class="hover:text-[#005DA8]">Home</a></li>
<li><a href="booking.html" class="hover:text-[#005DA8]">Book Now</a></li>
<li><a href="status.html" class="text-[#005DA8] font-semibold">Check Status</a></li>
</ul>
</nav>
</div>
</header>

<!-- Status Check Section -->
<section class="py-16">
<div class="container mx-auto px-4 max-w-4xl">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Check Your Booking Status</h2>

<div class="bg-white p-8 rounded-lg shadow-md mb-8">
<h3 class="text-xl font-semibold text-gray-800 mb-6">Enter Booking Details</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Booking Number</label>
<input type="text" id="bookingNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" placeholder="e.g., CW202501011234">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
<input type="tel" id="phoneNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" placeholder="e.g., +260 123 456789">
</div>
</div>
<div class="mt-6">
<button id="checkStatus" class="btn-primary px-6 py-3 rounded-lg">Check Status</button>
</div>
</div>

<!-- Booking Details Display -->
<div id="bookingDetails" class="hidden">
<div class="bg-white p-8 rounded-lg shadow-md mb-6">
<h3 class="text-2xl font-bold text-gray-800 mb-6">Booking Information</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<p class="text-sm text-gray-600">Booking Number</p>
<p id="displayBookingNumber" class="text-lg font-semibold text-gray-800"></p>
</div>
<div>
<p class="text-sm text-gray-600">Status</p>
<p id="displayStatus" class="text-lg font-semibold"></p>
</div>
<div>
<p class="text-sm text-gray-600">Service</p>
<p id="displayService" class="text-lg font-semibold text-gray-800"></p>
</div>
<div>
<p class="text-sm text-gray-600">Amount</p>
<p id="displayAmount" class="text-lg font-semibold text-[#005DA8]"></p>
</div>
<div>
<p class="text-sm text-gray-600">Scheduled Date</p>
<p id="displayDate" class="text-lg font-semibold text-gray-800"></p>
</div>
<div>
<p class="text-sm text-gray-600">Scheduled Time</p>
<p id="displayTime" class="text-lg font-semibold text-gray-800"></p>
</div>
<div>
<p class="text-sm text-gray-600">Vehicle Model</p>
<p id="displayVehicleModel" class="text-lg font-semibold text-gray-800"></p>
</div>
<div>
<p class="text-sm text-gray-600">License Plate</p>
<p id="displayVehiclePlate" class="text-lg font-semibold text-gray-800"></p>
</div>
</div>
<div id="pickupInfo" class="mt-6 hidden">
<div class="bg-gray-50 p-4 rounded-lg">
<h4 class="font-semibold text-gray-800 mb-2">Pickup Information</h4>
<p class="text-sm text-gray-600">Pickup Address: <span id="displayPickupAddress" class="font-medium"></span></p>
<p class="text-sm text-gray-600 mt-2">Drop-off Address: <span id="displayDropoffAddress" class="font-medium"></span></p>
</div>
</div>
<div id="slotInfo" class="mt-6 hidden">
<div class="bg-[#80B2D9] text-white p-4 rounded-lg">
<h4 class="font-semibold mb-2">Your Slot Number</h4>
<p id="displaySlotNumber" class="text-2xl font-bold"></p>
</div>
</div>
</div>

<!-- Payment Status -->
<div id="paymentStatus" class="bg-white p-8 rounded-lg shadow-md hidden">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Payment Status</h3>
<div id="paymentPending" class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg">
<p class="text-yellow-800">Payment verification pending. Please upload your payment screenshot or contact support.</p>
</div>
<div id="paymentVerified" class="bg-green-50 border border-green-200 p-4 rounded-lg hidden">
<p class="text-green-800">Payment verified! Your booking is confirmed.</p>
</div>
</div>

<!-- Navigation Section -->
<div id="navigationSection" class="bg-white p-8 rounded-lg shadow-md hidden mt-6">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Get Directions</h3>
<div class="mb-4">
<iframe id="mapFrame" width="100%" height="300" style="border:0" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
</div>
<button id="getDirections" class="btn-primary px-6 py-3 rounded-lg">Open in Google Maps</button>
</div>
</div>
</section>

<script>
document.getElementById('checkStatus').addEventListener('click', checkBookingStatus);

async function checkBookingStatus() {
const bookingNumber = document.getElementById('bookingNumber').value.trim();
const phoneNumber = document.getElementById('phoneNumber').value.trim();

if (!bookingNumber && !phoneNumber) {
alert('Please enter booking number or phone number');
return;
}

try {
let url = 'api/get_booking.php?';
if (bookingNumber && phoneNumber) {
url += `booking_number=${bookingNumber}&phone=${phoneNumber}`;
} else if (bookingNumber) {
url += `booking_number=${bookingNumber}`;
} else {
url += `phone=${phoneNumber}`;
}

const response = await fetch(url);
const result = await response.json();

if (result.success) {
displayBookingDetails(result.data);
} else {
alert('No booking found. Please check your details.');
}
} catch (error) {
console.error('Error checking status:', error);
alert('Failed to check booking status. Please try again.');
}
}

function displayBookingDetails(data) {
// Handle both single booking and array of bookings
const booking = Array.isArray(data) ? data[0] : data;

// Display booking details
document.getElementById('displayBookingNumber').textContent = booking.booking_number;
document.getElementById('displayService').textContent = booking.service_name;
document.getElementById('displayAmount').textContent = booking.amount_formatted;
document.getElementById('displayDate').textContent = formatDate(booking.scheduled_date);
document.getElementById('displayTime').textContent = booking.scheduled_time;
document.getElementById('displayVehicleModel').textContent = booking.vehicle_model;
document.getElementById('displayVehiclePlate').textContent = booking.vehicle_number_plate;

// Display status badge
const statusBadge = getStatusBadge(booking.status);
document.getElementById('displayStatus').innerHTML = statusBadge;

// Show pickup info if required
if (booking.pickup_required) {
document.getElementById('pickupInfo').classList.remove('hidden');
document.getElementById('displayPickupAddress').textContent = booking.pickup_address || 'Not specified';
document.getElementById('displayDropoffAddress').textContent = booking.dropoff_address || booking.pickup_address || 'Not specified';
} else {
document.getElementById('pickupInfo').classList.add('hidden');
}

// Show slot number if confirmed
if (booking.slot_number) {
document.getElementById('slotInfo').classList.remove('hidden');
document.getElementById('displaySlotNumber').textContent = booking.slot_number;
} else {
document.getElementById('slotInfo').classList.add('hidden');
}

// Show payment status
document.getElementById('paymentStatus').classList.remove('hidden');
if (booking.payment_confirmed) {
document.getElementById('paymentVerified').classList.remove('hidden');
document.getElementById('paymentPending').classList.add('hidden');
} else {
document.getElementById('paymentVerified').classList.add('hidden');
document.getElementById('paymentPending').classList.remove('hidden');
}

// Show navigation if not pickup
if (!booking.pickup_required) {
document.getElementById('navigationSection').classList.remove('hidden');
loadMap();
document.getElementById('getDirections').addEventListener('click', function() {
window.open('https://www.google.com/maps/dir/?api=1&destination=-12.8153,28.2139', '_blank');
});
} else {
document.getElementById('navigationSection').classList.add('hidden');
}

document.getElementById('bookingDetails').classList.remove('hidden');
}

function getStatusBadge(status) {
const badges = {
'pending_payment': '<span class="status-badge status-pending">Pending Payment</span>',
'payment_verified': '<span class="status-badge status-confirmed">Payment Verified</span>',
'confirmed': '<span class="status-badge status-confirmed">Confirmed</span>',
'in_queue': '<span class="status-badge status-progress">In Queue</span>',
'in_progress': '<span class="status-badge status-progress">In Progress</span>',
'completed': '<span class="status-badge status-completed">Completed</span>',
'cancelled': '<span class="status-badge status-pending">Cancelled</span>'
};
return badges[status] || '<span class="status-badge status-pending">' + status + '</span>';
}

function formatDate(dateString) {
const date = new Date(dateString);
return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}

function loadMap() {
const mapFrame = document.getElementById('mapFrame');
mapFrame.src = 'https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=-12.8153,28.2139';
}
</script>

</body>
</html>

