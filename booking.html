<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Book a Wash - Copperway Car Wash</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
.btn-primary { background-color: #005DA8; color: white; }
.btn-secondary { border-color: #005DA8; color: #005DA8; }
</style>
</head>
<body class="font-sans bg-gray-50">
<!-- Header -->
<header class="sticky top-0 bg-white shadow-md z-50">
<div class="container mx-auto flex justify-between items-center p-4">
<div class="text-2xl font-bold text-[#005DA8]">Copperway Car Wash</div>
<nav>
<ul class="flex space-x-6">
<li><a href="index.html" class="hover:text-[#005DA8]">Home</a></li>
<li><a href="index.html#services" class="hover:text-[#005DA8]">Services</a></li>
<li><a href="booking.html" class="text-[#005DA8] font-semibold">Book Now</a></li>
<li><a href="status.html" class="hover:text-[#005DA8]">Check Status</a></li>
</ul>
</nav>
</div>
</header>

<!-- Booking Form Section -->
<section class="py-16">
<div class="container mx-auto px-4 max-w-4xl">
<h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Book Your Car Wash</h2>

<div id="bookingForm">
<!-- Step 1: Service Selection -->
<div id="step1" class="bg-white p-8 rounded-lg shadow-md">
<h3 class="text-xl font-semibold text-gray-800 mb-6">1. Select Service</h3>
<div id="servicesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
<!-- Services will be loaded here -->
</div>
<div class="mt-6">
<button id="nextStep1" class="btn-primary px-6 py-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>Next: Vehicle Details</button>
</div>
</div>

<!-- Step 2: Vehicle Details -->
<div id="step2" class="bg-white p-8 rounded-lg shadow-md hidden mt-6">
<h3 class="text-xl font-semibold text-gray-800 mb-6">2. Vehicle Information</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Model *</label>
<input type="text" id="vehicleModel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">License Plate *</label>
<input type="text" id="vehiclePlate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" required>
</div>
</div>
<div class="mt-6">
<button id="backStep2" class="btn-secondary px-6 py-3 rounded-lg mr-4">Back</button>
<button id="nextStep2" class="btn-primary px-6 py-3 rounded-lg">Next: Date & Time</button>
</div>
</div>

<!-- Step 3: Date & Time -->
<div id="step3" class="bg-white p-8 rounded-lg shadow-md hidden mt-6">
<h3 class="text-xl font-semibold text-gray-800 mb-6">3. Select Date & Time</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Date *</label>
<input type="date" id="bookingDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Time Slot *</label>
<select id="bookingTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" required>
<option value="">Select time...</option>
</select>
</div>
</div>
<div class="mt-6">
<button id="backStep3" class="btn-secondary px-6 py-3 rounded-lg mr-4">Back</button>
<button id="nextStep3" class="btn-primary px-6 py-3 rounded-lg">Next: Contact Info</button>
</div>
</div>

<!-- Step 4: Contact Information -->
<div id="step4" class="bg-white p-8 rounded-lg shadow-md hidden mt-6">
<h3 class="text-xl font-semibold text-gray-800 mb-6">4. Contact Information</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
<input type="text" id="customerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label>
<input type="tel" id="customerPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" required>
</div>
</div>
<div class="mt-6">
<label class="block text-sm font-medium text-gray-700 mb-2">Email (Optional)</label>
<input type="email" id="customerEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]">
</div>
<div class="mt-6">
<button id="backStep4" class="btn-secondary px-6 py-3 rounded-lg mr-4">Back</button>
<button id="nextStep4" class="btn-primary px-6 py-3 rounded-lg">Next: Pickup Options</button>
</div>
</div>

<!-- Step 5: Pickup Options -->
<div id="step5" class="bg-white p-8 rounded-lg shadow-md hidden mt-6">
<h3 class="text-xl font-semibold text-gray-800 mb-6">5. Pickup Service</h3>
<div class="mb-6">
<label class="flex items-center">
<input type="checkbox" id="pickupRequired" class="mr-3 w-5 h-5">
<span class="text-gray-700">I need pickup and drop-off service</span>
</label>
</div>
<div id="pickupFields" class="hidden">
<div class="grid grid-cols-1 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Pickup Address</label>
<input type="text" id="pickupAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" placeholder="Enter your pickup location">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Drop-off Address (if different)</label>
<input type="text" id="dropoffAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-[#005DA8]" placeholder="Enter drop-off location">
</div>
</div>
</div>
<div class="mt-6">
<button id="backStep5" class="btn-secondary px-6 py-3 rounded-lg mr-4">Back</button>
<button id="submitBooking" class="btn-primary px-6 py-3 rounded-lg">Submit Booking</button>
</div>
</div>
</div>

<!-- Booking Confirmation -->
<div id="bookingConfirmation" class="bg-white p-8 rounded-lg shadow-md hidden">
<h3 class="text-2xl font-bold text-[#005DA8] mb-4">Booking Confirmed!</h3>
<p class="text-gray-600 mb-6">Your booking number is:</p>
<div class="bg-[#80B2D9] text-white p-6 rounded-lg text-center mb-6">
<h4 id="bookingNumberDisplay" class="text-3xl font-bold"></h4>
</div>
<div class="bg-gray-50 p-6 rounded-lg mb-6">
<h4 class="font-semibold text-gray-800 mb-4">Payment Instructions</h4>
<p class="text-gray-600 mb-2">Amount: <span id="amountDisplay" class="font-bold"></span></p>
<p class="text-gray-600 mb-4">Please make payment using one of the following methods:</p>
<ul class="list-disc list-inside text-gray-600 space-y-2">
<li>Mobile Money: +260 123 456789</li>
<li>Bank Transfer: Account details available on request</li>
<li>Cash payment at location</li>
</ul>
</div>
<div class="flex space-x-4">
<button id="uploadPayment" class="btn-primary px-6 py-3 rounded-lg">Upload Payment Screenshot</button>
<button id="contactSupport" class="btn-secondary px-6 py-3 rounded-lg">Contact Support</button>
</div>
</div>

<!-- Payment Upload Modal -->
<div id="paymentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
<div class="bg-white p-8 rounded-lg max-w-md w-full mx-4">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Upload Payment Screenshot</h3>
<form id="paymentUploadForm" enctype="multipart/form-data">
<input type="file" id="paymentFile" name="payment_screenshot" accept="image/*" class="mb-4" required>
<div class="flex space-x-4">
<button type="button" id="cancelUpload" class="btn-secondary px-6 py-3 rounded-lg">Cancel</button>
<button type="submit" class="btn-primary px-6 py-3 rounded-lg">Upload</button>
</div>
</form>
</div>
</div>
</div>
</section>

<script>
// Global variables
let selectedService = null;
let bookingNumber = null;

// Load services on page load
document.addEventListener('DOMContentLoaded', function() {
loadServices();
setMinDate();
setupEventListeners();
});

function setMinDate() {
const today = new Date().toISOString().split('T')[0];
document.getElementById('bookingDate').setAttribute('min', today);
}

function setupEventListeners() {
// Step navigation
document.getElementById('nextStep1').addEventListener('click', () => showStep(2));
document.getElementById('backStep2').addEventListener('click', () => showStep(1));
document.getElementById('nextStep2').addEventListener('click', () => showStep(3));
document.getElementById('backStep3').addEventListener('click', () => showStep(2));
document.getElementById('nextStep3').addEventListener('click', () => showStep(4));
document.getElementById('backStep4').addEventListener('click', () => showStep(3));
document.getElementById('nextStep4').addEventListener('click', () => showStep(5));
document.getElementById('backStep5').addEventListener('click', () => showStep(4));
document.getElementById('submitBooking').addEventListener('click', submitBooking);

// Date change handler
document.getElementById('bookingDate').addEventListener('change', loadTimeSlots);

// Pickup checkbox handler
document.getElementById('pickupRequired').addEventListener('change', function() {
const pickupFields = document.getElementById('pickupFields');
if (this.checked) {
pickupFields.classList.remove('hidden');
} else {
pickupFields.classList.add('hidden');
}
});

// Payment upload handlers
document.getElementById('uploadPayment').addEventListener('click', () => {
document.getElementById('paymentModal').classList.remove('hidden');
});
document.getElementById('cancelUpload').addEventListener('click', () => {
document.getElementById('paymentModal').classList.add('hidden');
});
document.getElementById('paymentUploadForm').addEventListener('submit', uploadPayment);

// Contact support
document.getElementById('contactSupport').addEventListener('click', function() {
window.location.href = 'tel:+260123456789';
});
}

function showStep(step) {
// Hide all steps
for (let i = 1; i <= 5; i++) {
document.getElementById('step' + i).classList.add('hidden');
}
// Show current step
document.getElementById('step' + step).classList.remove('hidden');
}

async function loadServices() {
try {
const response = await fetch('api/get_services.php');
const result = await response.json();
if (result.success) {
displayServices(result.data);
}
} catch (error) {
console.error('Error loading services:', error);
}
}

function displayServices(services) {
const container = document.getElementById('servicesContainer');
container.innerHTML = '';
services.forEach(service => {
const card = document.createElement('div');
card.className = 'border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-[#005DA8] transition';
card.innerHTML = `
<h4 class="font-semibold text-gray-800">${service.name}</h4>
<p class="text-sm text-gray-600 mt-2">${service.description}</p>
<p class="text-lg font-bold text-[#005DA8] mt-4">$${service.price}</p>
<p class="text-sm text-gray-500">Duration: ${service.duration} minutes</p>
`;
card.addEventListener('click', () => selectService(service, card));
container.appendChild(card);
});
}

function selectService(service, card) {
// Remove selection from all cards
document.querySelectorAll('#servicesContainer > div').forEach(c => {
c.classList.remove('border-[#005DA8]', 'bg-blue-50');
});
// Select this card
card.classList.add('border-[#005DA8]', 'bg-blue-50');
selectedService = service;
document.getElementById('nextStep1').disabled = false;
}

async function loadTimeSlots() {
const date = document.getElementById('bookingDate').value;
if (!date) return;

try {
const response = await fetch(`api/get_slots.php?date=${date}`);
const result = await response.json();
if (result.success) {
displayTimeSlots(result.data);
}
} catch (error) {
console.error('Error loading time slots:', error);
}
}

function displayTimeSlots(slots) {
const select = document.getElementById('bookingTime');
select.innerHTML = '<option value="">Select time...</option>';
slots.forEach(slot => {
const option = document.createElement('option');
option.value = slot;
option.textContent = slot;
select.appendChild(option);
});
}

async function submitBooking() {
// Validate all fields
if (!selectedService) {
alert('Please select a service');
return;
}

const vehicleModel = document.getElementById('vehicleModel').value;
const vehiclePlate = document.getElementById('vehiclePlate').value;
const bookingDate = document.getElementById('bookingDate').value;
const bookingTime = document.getElementById('bookingTime').value;
const customerName = document.getElementById('customerName').value;
const customerPhone = document.getElementById('customerPhone').value;
const customerEmail = document.getElementById('customerEmail').value;
const pickupRequired = document.getElementById('pickupRequired').checked;
const pickupAddress = document.getElementById('pickupAddress').value;
const dropoffAddress = document.getElementById('dropoffAddress').value;

if (!vehicleModel || !vehiclePlate || !bookingDate || !bookingTime || !customerName || !customerPhone) {
alert('Please fill in all required fields');
return;
}

if (pickupRequired && !pickupAddress) {
alert('Please provide pickup address');
return;
}

const bookingData = {
service_id: selectedService.id,
vehicle_model: vehicleModel,
vehicle_number_plate: vehiclePlate,
scheduled_date: bookingDate,
scheduled_time: bookingTime,
customer_name: customerName,
customer_phone: customerPhone,
customer_email: customerEmail,
pickup_required: pickupRequired,
pickup_address: pickupAddress,
dropoff_address: dropoffAddress
};

try {
const response = await fetch('api/create_booking.php', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify(bookingData)
});

const result = await response.json();
if (result.success) {
bookingNumber = result.data.booking_number;
showConfirmation(result.data);
} else {
alert('Error: ' + result.message);
}
} catch (error) {
console.error('Error creating booking:', error);
alert('Failed to create booking. Please try again.');
}
}

function showConfirmation(data) {
document.getElementById('bookingForm').classList.add('hidden');
document.getElementById('bookingConfirmation').classList.remove('hidden');
document.getElementById('bookingNumberDisplay').textContent = data.booking_number;
document.getElementById('amountDisplay').textContent = '$' + data.amount;
}

async function uploadPayment(e) {
e.preventDefault();
const fileInput = document.getElementById('paymentFile');
if (!fileInput.files.length) {
alert('Please select a file');
return;
}

const formData = new FormData();
formData.append('payment_screenshot', fileInput.files[0]);
formData.append('booking_number', bookingNumber);

try {
const response = await fetch('api/upload_payment.php', {
method: 'POST',
body: formData
});

const result = await response.json();
if (result.success) {
alert('Payment screenshot uploaded successfully! Our team will verify it shortly.');
document.getElementById('paymentModal').classList.add('hidden');
} else {
alert('Error: ' + result.message);
}
} catch (error) {
console.error('Error uploading payment:', error);
alert('Failed to upload payment screenshot. Please try again.');
}
}
</script>

</body>
</html>

